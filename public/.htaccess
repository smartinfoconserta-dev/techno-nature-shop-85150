# ==========================================
# RAMON TECH - Configura√ß√£o DEFINITIVA
# ==========================================

# MIME Types
AddType application/javascript .js .mjs
AddType text/css .css
AddType application/json .json
AddDefaultCharset UTF-8

# ==========================================
# üîí FOR√áAR HTTPS E DOM√çNIO PRINCIPAL
# ==========================================
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # For√ßa HTTPS
  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  
  # Redireciona www para n√£o-www
  RewriteCond %{HTTP_HOST} ^www\.ramontech\.com\.br$ [NC]
  RewriteRule ^(.*)$ https://ramontech.com.br/$1 [L,R=301]
  
  # SPA Support - Redireciona tudo para index.html
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [L]
</IfModule>

# ==========================================
# üö´ DESABILITAR CACHE DE CDN (CLOUDFLARE)
# ==========================================
<IfModule mod_headers.c>
  # HTML: ZERO CACHE (navegador + CDN)
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0, s-maxage=0"
    Header set Pragma "no-cache"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
    Header set X-Accel-Expires "0"
    
    # Desabilita cache no Cloudflare especificamente
    Header set CDN-Cache-Control "no-store"
    Header set Cloudflare-CDN-Cache-Control "no-store"
    
    # Remove ETag est√°tico
    Header unset ETag
    FileETag None
  </FilesMatch>
  
  # Assets com hash: cache LONGO (1 ano)
  <FilesMatch "\.[a-f0-9]{8,}\.(js|css|png|jpg|jpeg|webp|svg|woff|woff2)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  
  # Assets SEM hash: cache CURTO (1 hora)
  <FilesMatch "^((?!\.[a-f0-9]{8,}\.).)*\.(js|css|png|jpg|jpeg|svg)$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
  </FilesMatch>
</IfModule>

# ==========================================
# üîê HEADERS DE SEGURAN√áA
# ==========================================
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# ==========================================
# üóúÔ∏è COMPRESS√ÉO GZIP
# ==========================================
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json
</IfModule>

# ==========================================
# üõ°Ô∏è PROTE√á√ÉO DE ARQUIVOS SENS√çVEIS
# ==========================================
<FilesMatch "^\.">
  Order allow,deny
  Deny from all
</FilesMatch>

Options -Indexes
